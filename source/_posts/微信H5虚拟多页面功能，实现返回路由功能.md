---
title: 微信H5虚拟多页面功能，实现返回路由功能
date: 2017-03-16 21:25:38
categories: 移动端
---
# 背景
公司最近说要做一个微信查物流信息的H5页面，一共两个page,首页是查询输入，输入好确认跳转到了结果页，大概就是这么一回事。太久没做移动端页面，当时就没考虑back回退问题了，两个页面统一写在一个html内，可以减少http请求和等待。后来完工，需求提出了这个问题，那便来处理了。
<!-- more --> 

# 解决方案
这个页面我搭好了架构，便把剩下的抛了一个同事练练手，他在处理时，提出向左滑动，页面便随着左移动，回到了首页。但是出于这是一种隐性的回退处理，用户不一定能晓得，所以便只能作为辅助的回退。多方咨询，另一个同事提到，可以模仿react-router的思想，在前端做一个假的路由，更改url方式，骗过微信浏览器。恩，挺不错的方案，便动手操作了。

# 实现
     _bindAction: function () {

        var _self = this;

        $(this.nodes.queryBtn).on('click', function (e) { //进入结果页

            _self._turnHome();
           
            window.history.pushState({time: Date.now()}, '', 'index.html?status=push'); // 改变路由

            _self._getResult(_self._turnHome, _self._renderTimeLine);
        });

        window.onpopstate = function () { // 监听路由回退
            $(_self.nodes.rightPage).removeClass(_self.class.turnHome);
        };
    }

# 结论 
这些api属于H5功能，所以存在浏览器兼容性问题(android4.2+, safari6+, chrome5+, ie10+)。但因为环境是移动端，所以不用考虑兼容性问题。恩，骗人的事不能做，骗骗浏览器还是可以的，又学到了一招，哈哈。  